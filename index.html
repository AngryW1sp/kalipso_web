<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KALIPSO ‚Äî –∏–Ω—Ç–µ—Ä–Ω–µ—Ç‚Äë–≤–∏—Ç—Ä–∏–Ω–∞ –±–∞—Å—Å–µ–π–Ω–æ–≤ –∏ –¥–æ–º–∞—à–Ω–µ–≥–æ SPA</title>
  <meta name="description" content="–ö–∞—Ç–∞–ª–æ–≥ —Ä–µ—à–µ–Ω–∏–π –¥–ª—è –±–∞—Å—Å–µ–π–Ω–æ–≤ –∏ –¥–æ–º–∞—à–Ω–µ–≥–æ SPA. –ë—ã—Å—Ç—Ä—ã–π –ø–æ–¥–±–æ—Ä —á–µ—Ä–µ–∑ –∫–≤–∏–∑ –∏ –ø–µ—Ä–µ—Ö–æ–¥ –≤ Telegram." />
  <style>
    :root{
      --bg:#F6F7FA;
      --panel:#FFFFFF;
      --text:#0B1220;
      --muted:#556070;
      --primary:#0E4DB2;
      --accent:#249CDF;
      --gold:#F1A725;
      --line:rgba(11,18,32,.10);
      --line2:rgba(14,77,178,.12);
      --ring:rgba(14,77,178,.18);
      --shadow:0 14px 34px rgba(11,18,32,.08);
      --radius:18px;
      --radius-sm:14px;
      --max:1180px;
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      color:var(--text);
      background: var(--bg);
    }
    a{color:inherit;text-decoration:none}
    .container{max-width:var(--max);margin:0 auto;padding:0 16px}
    .mono{font-variant-numeric: tabular-nums}

    /* Top utility bar */
    .topbar{
      background:#fff;
      border-bottom:1px solid rgba(11,18,32,.08);
      font-size:12px;
      color:var(--muted);
    }
    .topbar .row{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding:10px 0;
    }
    .topbar b{color:var(--text)}
    .topbar a{color:var(--text); font-weight:800}
    .topLeft{display:flex; align-items:center; gap:16px; flex-wrap:wrap}
    .topRight{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
    .cityBtn{
      border:1px solid rgba(11,18,32,.10);
      background:transparent;
      padding:6px 10px;
      border-radius:999px;
      cursor:pointer;
      font-weight:900;
      color:var(--text);
    }

    /* Header */
    header{
      position:sticky;
      top:0;
      z-index:50;
      background:rgba(255,255,255,.90);
      backdrop-filter: blur(12px);
      border-bottom:1px solid rgba(11,18,32,.08);
    }
    .headRow{
      display:grid;
      grid-template-columns: 220px 1fr 260px;
      gap:16px;
      align-items:center;
      padding:14px 0;
    }
    .brand{
      display:flex; gap:10px; align-items:center;
      min-width:0;
    }
    .logoMark{
      width:42px;height:42px;border-radius:14px;
      background: radial-gradient(circle at 30% 20%, rgba(36,156,223,.9), rgba(14,77,178,.95));
      position:relative;
      overflow:hidden;
      flex:0 0 auto;
    }
    .logoMark:before{
      content:"";
      position:absolute; inset:-40% -30%;
      background: conic-gradient(from 180deg, rgba(241,167,37,.9), rgba(36,156,223,.0), rgba(14,77,178,.8));
      transform: rotate(20deg);
      opacity:.45;
    }
    .brandTxt{min-width:0; line-height:1.1}
    .brandTxt b{display:block; letter-spacing:.06em}
    .brandTxt span{display:block; font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis}

    /* Mega menu */
    .nav{
      display:flex; gap:12px; align-items:center; flex-wrap:wrap;
    }
    .navItem{
      position:relative;
      font-weight:900;
      font-size:14px;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid transparent;
      cursor:pointer;
      user-select:none;
    }
    .navItem:hover{background:rgba(14,77,178,.05); border-color:rgba(14,77,178,.12)}
    .drop{
      position:absolute;
      left:0;
      top:44px;
      width:340px;
      background:#fff;
      border:1px solid rgba(11,18,32,.10);
      border-radius:18px;
      box-shadow: var(--shadow);
      padding:10px;
      display:none;
    }
    .navItem:hover .drop{display:block}
    .drop a{
      display:flex;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid transparent;
      font-weight:800;
      color:var(--text);
    }
    .drop a:hover{background:rgba(14,77,178,.05); border-color:rgba(14,77,178,.12)}
    .drop .hint{font-size:12px;color:var(--muted); padding:8px 12px 4px}

    /* Search + icons */
    .actions{
      display:flex; gap:10px; align-items:center; justify-content:flex-end;
    }
    .search{
      display:flex; align-items:center; gap:10px;
      border:1px solid rgba(11,18,32,.12);
      border-radius:999px;
      padding:10px 12px;
      background:transparent;
      min-width:0;
      flex:1;
    }
    .search input{
      border:0; outline:0; background:transparent;
      width:100%;
      font-size:14px;
    }
    .iconBtn{
      width:44px;height:44px;
      border-radius:14px;
      border:1px solid rgba(11,18,32,.12);
      background:transparent;
      cursor:pointer;
      position:relative;
      display:grid;
      place-items:center;
      font-weight:1000;
    }
    .badge{
      position:absolute;
      top:6px; right:6px;
      min-width:18px; height:18px;
      padding:0 5px;
      border-radius:999px;
      background:var(--primary);
      color:#fff;
      font-size:11px;
      display:grid; place-items:center;
    }

    /* Minimal buttons */
    .btn{
      display:inline-flex;align-items:center;justify-content:center;
      gap:10px;padding:12px 14px;border-radius:14px;
      border:1px solid rgba(11,18,32,.14);
      background:transparent;
      font-weight:900;cursor:pointer;
      transition:background-color .15s ease,border-color .15s ease,color .15s ease,filter .15s ease;
      text-align:center;user-select:none;
      white-space:nowrap;
    }
    .btn:hover{border-color:rgba(14,77,178,.35);background:rgba(14,77,178,.04)}
    .btn:active{filter:brightness(.96)}
    .btnPrimary{background:var(--primary);color:#fff;border-color:transparent;}
    .btnPrimary:hover{filter:brightness(.95)}
    .btnSm{padding:10px 12px;border-radius:12px;font-size:13px}

    /* Layout */
    .main{padding:18px 0 52px}
    .crumbs{font-size:12px;color:var(--muted); margin:10px 0}
    .pageTitle{
      display:flex; align-items:flex-end; justify-content:space-between; gap:14px; flex-wrap:wrap;
      margin:10px 0 14px;
    }
    h1{margin:0; font-size:28px; letter-spacing:-.01em}
    .subtitle{margin:0; color:var(--muted); max-width:70ch; line-height:1.5}
    .grid{
      display:grid;
      grid-template-columns: 280px 1fr;
      gap:16px;
      align-items:start;
      margin-top:16px;
    }
    .panel{
      background:#fff;
      border:1px solid rgba(11,18,32,.10);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    /* Filters (left) */
    .filters{padding:14px}
    .filters h3{margin:0 0 10px; font-size:16px}
    .fGroup{padding:12px 0; border-top:1px solid rgba(11,18,32,.08)}
    .fGroup:first-of-type{border-top:0;padding-top:0}
    .fGroup b{display:block; margin-bottom:8px}
    .check{display:flex; align-items:center; gap:10px; margin:8px 0; color:var(--muted); font-size:13px}
    .check input{width:16px;height:16px}
    .rangeRow{display:flex; gap:10px}
    .in{
      width:100%;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid rgba(11,18,32,.12);
      background:transparent;
      outline:none;
      font-size:13px;
    }
    .in:focus{border-color:rgba(14,77,178,.55); box-shadow:0 0 0 4px var(--ring)}
    .filters .cta{
      display:grid; gap:10px;
      margin-top:10px;
    }

    /* Catalog */
    .catalog{padding:14px}
    .toolbar{
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center; justify-content:space-between;
      margin-bottom:12px;
    }
    .sort{
      display:flex; gap:8px; align-items:center;
      color:var(--muted); font-size:13px;
    }
    .sort select{
      padding:10px 10px;
      border-radius:12px;
      border:1px solid rgba(11,18,32,.12);
      background:transparent;
      font-weight:800;
      outline:none;
    }
    .count{color:var(--muted); font-size:13px}
    .cards{
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap:12px;
    }
    .card{
      border:1px solid rgba(11,18,32,.10);
      border-radius: 18px;
      overflow:hidden;
      background:#fff;
      display:flex;
      flex-direction:column;
      min-height: 360px;
    }
    .img{
      height:150px;
      background: linear-gradient(135deg, rgba(14,77,178,.12), rgba(36,156,223,.08));
      position:relative;
      overflow:hidden;
    }
    .img:after{
      content:"";
      position:absolute; inset:-40% -25%;
      background: radial-gradient(circle at 25% 25%, rgba(36,156,223,.30), rgba(36,156,223,0) 55%);
      transform: rotate(10deg);
    }
    .labels{
      position:absolute; left:10px; top:10px;
      display:flex; gap:8px; flex-wrap:wrap;
    }
    .lab{
      font-size:11px;
      font-weight:1000;
      padding:5px 8px;
      border-radius:999px;
      background:rgba(255,255,255,.86);
      border:1px solid rgba(11,18,32,.10);
    }
    .lab.gold{background:rgba(241,167,37,.16); border-color:rgba(241,167,37,.35)}
    .body{padding:12px 12px 14px; display:flex; flex-direction:column; gap:8px; flex:1}
    .name{font-weight:1000; font-size:14px; line-height:1.25}
    .desc{color:var(--muted); font-size:12.5px; line-height:1.45}
    .priceRow{display:flex; align-items:baseline; justify-content:space-between; gap:10px; margin-top:auto}
    .price{font-weight:1000}
    .old{font-size:12px; color:rgba(85,96,112,.9); text-decoration: line-through}
    .benefit{font-size:12px; color:var(--muted)}
    .cardBtns{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    .cardBtns .btn{flex:1}

    /* Quiz */
    .quizShell{margin-top:16px}
    .quizHead{
      padding:16px;
      border-bottom:1px solid rgba(11,18,32,.08);
    }
    .quizHead h2{margin:0; font-size:20px}
    .quizHead p{margin:8px 0 0; color:var(--muted); line-height:1.5}
    .quizGrid{
      display:grid;
      grid-template-columns: 1fr 320px;
      gap:14px;
      padding:14px;
    }
    .quizCard{
      border:1px solid rgba(11,18,32,.10);
      border-radius: 18px;
      padding:16px;
      background:rgba(255,255,255,.92);
    }
    .quizTop{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom:12px;
    }
    .progress{
      height:10px; border-radius:999px;
      background: rgba(11,18,32,.08);
      overflow:hidden; flex:1;
    }
    .bar{height:100%; width:0%; background: linear-gradient(90deg, var(--primary), var(--accent))}
    .qTitle{font-weight:1000; font-size:15px; margin:8px 0 10px}
    .opts{display:flex; flex-wrap:wrap; gap:10px}
    .opt{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(11,18,32,.12);
      background:transparent;
      cursor:pointer;
      font-weight:900;
      font-size:13px;
      transition:.12s ease;
    }
    .opt:hover{border-color:rgba(14,77,178,.35); box-shadow:0 0 0 4px var(--ring)}
    .fields{display:grid; gap:10px; margin-top:10px}
    .quizNav{display:flex; gap:10px; margin-top:12px}
    .aside{
      border:1px solid rgba(11,18,32,.10);
      border-radius: 18px;
      background: rgba(255,255,255,.78);
      padding:14px;
      height: fit-content;
    }
    .aside b{display:block; margin-bottom:8px}
    .miniList{margin:0; padding-left:18px; color:var(--muted); font-size:13px; line-height:1.5}
    .success{
      display:none;
      padding:16px;
      border-radius: 18px;
      border:1px solid rgba(14,77,178,.16);
      background: rgba(36,156,223,.07);
      margin-top:12px;
    }
    .success b{display:block; font-size:16px; margin-bottom:6px}

    /* Cart drawer */
    .overlay{
      position:fixed; inset:0;
      background:rgba(11,18,32,.45);
      display:none;
      z-index:80;
    }
    .drawer{
      position:absolute; top:10px; right:10px;
      width:min(420px, calc(100% - 20px));
      background:#fff;
      border-radius:22px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .drawerHead{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 14px;
      border-bottom:1px solid rgba(11,18,32,.08);
      font-weight:1000;
    }
    .closeBtn{
      width:44px;height:44px;border-radius:14px;
      border:1px solid rgba(11,18,32,.12);
      background: transparent;
      cursor:pointer;
      display:grid; place-items:center;
      font-weight:1000;
    }
    .drawerBody{padding:12px}
    .cartItem{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 0;
      border-top:1px solid rgba(11,18,32,.08);
    }
    .cartItem:first-child{border-top:0;padding-top:0}
    .thumb{width:56px;height:56px;border-radius:14px;border:1px solid rgba(11,18,32,.10);
      background: linear-gradient(135deg, rgba(14,77,178,.10), rgba(36,156,223,.06));
      flex:0 0 auto;
    }
    .cartItem b{display:block; font-size:13px}
    .cartItem span{display:block; font-size:12px; color:var(--muted); margin-top:2px}
    .drawerFoot{padding:12px;border-top:1px solid rgba(11,18,32,.08); display:grid; gap:10px}

    /* Footer */
    footer{
      margin-top:28px;
      padding:28px 0;
      color:var(--muted);
      font-size:12px;
    }
    .foot{
      display:grid;
      grid-template-columns: 1.2fr 1fr 1fr;
      gap:14px;
    }
    .foot b{color:var(--text)}
    .foot a{color:var(--text); font-weight:800}
    .small{margin-top:12px; color:var(--muted)}
    .hr{height:1px;background:rgba(11,18,32,.08);margin:14px 0}

    /* Mobile */
    .burger{
      display:none;
      width:44px;height:44px;border-radius:14px;
      border:1px solid rgba(11,18,32,.12);
      background:transparent;
      cursor:pointer;
      place-items:center;
    }
    .burger i{display:block;width:18px;height:2px;background:var(--text);position:relative}
    .burger i:before,.burger i:after{content:"";position:absolute;left:0;width:18px;height:2px;background:var(--text)}
    .burger i:before{top:-6px}
    .burger i:after{top:6px}
    .mobileNav{
      display:none;
      padding:10px 0 14px;
      border-top:1px solid rgba(11,18,32,.08);
    }
    .mobileNav .navItem{display:block}
    .mobileNav a{display:block;padding:12px 10px;border-radius:14px;font-weight:900}
    .mobileNav a:hover{background:rgba(14,77,178,.05)}
    @media (max-width: 1060px){
      .headRow{grid-template-columns: 1fr}
      .nav{display:none}
      .burger{display:grid}
      .actions{justify-content:stretch}
      .search{flex:1}
      .grid{grid-template-columns: 1fr}
      .cards{grid-template-columns: 1fr 1fr}
      .quizGrid{grid-template-columns: 1fr}
      .foot{grid-template-columns: 1fr}
    }
    @media (max-width: 560px){
      .cards{grid-template-columns: 1fr}
      h1{font-size:24px}
      .topLeft{gap:10px}
    }
  </style>
</head>
<body>

<div class="topbar">
  <div class="container">
    <div class="row">
      <div class="topLeft">
        <div><b>–§–∏–∑. –ª–∏—Ü–∞–º:</b> <a class="mono" href="tel:{PHONE}">{PHONE}</a></div>
        <div><a href="mailto:{EMAIL}">{EMAIL}</a></div>
        <div style="opacity:.55">|</div>
        <div><b>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º:</b> <span class="mono">{B2B_PHONE}</span></div>
      </div>
      <div class="topRight">
        <button class="cityBtn" id="cityBtn">–ì–æ—Ä–æ–¥: <span id="cityInline">{CITY}</span></button>
        <a href="#contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
      </div>
    </div>
  </div>
</div>

<header>
  <div class="container">
    <div class="headRow">
      <div style="display:flex;align-items:center;gap:10px;">
        <button class="burger" id="burger" aria-label="–ú–µ–Ω—é"><i></i></button>
        <a class="brand" href="#top" aria-label="KALIPSO">
          <div class="logoMark" aria-hidden="true"></div>
          <div class="brandTxt">
            <b>KALIPSO</b>
            <span>–ë–∞—Å—Å–µ–π–Ω—ã ‚Ä¢ –î–æ–º–∞—à–Ω–µ–µ SPA ‚Ä¢ –ü–æ–¥–±–æ—Ä –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</span>
          </div>
        </a>
      </div>

      <nav class="nav" aria-label="–†–∞–∑–¥–µ–ª—ã">
        <div class="navItem">–°–ü–ê –¥–æ–º–∞
          <div class="drop">
            <div class="hint">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</div>
            <a href="#catalog" data-tag="spa_ir">–ò–Ω—Ñ—Ä–∞–∫—Ä–∞—Å–Ω—ã–µ –∫–∞–±–∏–Ω—ã</a>
            <a href="#catalog" data-tag="spa_hot">–ì–∏–¥—Ä–æ–º–∞—Å—Å–∞–∂–Ω—ã–µ —Å–ø–∞‚Äë–≤–∞–Ω–Ω—ã</a>
            <a href="#quiz">–ó–∞–∫–∞–∑–∞—Ç—å –ø–æ–¥–±–æ—Ä</a>
          </div>
        </div>
        <div class="navItem">–ë–∞—Å—Å–µ–π–Ω –¥–æ–º–∞
          <div class="drop">
            <div class="hint">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</div>
            <a href="#catalog" data-tag="pool_chem">–•–∏–º–∏—è –¥–ª—è –±–∞—Å—Å–µ–π–Ω–∞</a>
            <a href="#catalog" data-tag="pool_robot">–†–æ–±–æ—Ç—ã‚Äë–ø—ã–ª–µ—Å–æ—Å—ã</a>
            <a href="#catalog" data-tag="pool_wood">–ë–∞—Å—Å–µ–π–Ω—ã (–ø–æ–¥ –∫–ª—é—á)</a>
            <a href="#quiz">–ó–∞–∫–∞–∑–∞—Ç—å –ø–æ–¥–±–æ—Ä</a>
          </div>
        </div>
        <a class="navItem" href="#catalog">–ê–∫—Ü–∏–∏</a>
        <a class="navItem" href="#service">–°–µ—Ä–≤–∏—Å</a>
        <a class="navItem" href="#contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
      </nav>

      <div class="actions">
        <div class="search" role="search" aria-label="–ü–æ–∏—Å–∫">
          <span style="font-weight:1000;color:rgba(85,96,112,.8)">üîé</span>
          <input id="searchInput" placeholder="–Ø –∏—â—É" />
        </div>
        <button class="iconBtn" id="favBtn" aria-label="–ò–∑–±—Ä–∞–Ω–Ω–æ–µ">‚ô•
          <span class="badge" id="favCount">0</span>
        </button>
        <button class="iconBtn" id="cartBtn" aria-label="–ö–æ—Ä–∑–∏–Ω–∞">üõí
          <span class="badge" id="cartCount">0</span>
        </button>
      </div>

      <div class="mobileNav" id="mobileNav">
        <a href="#catalog">–ê–∫—Ü–∏–∏</a>
        <a href="#quiz">–ó–∞–∫–∞–∑–∞—Ç—å –ø–æ–¥–±–æ—Ä</a>
        <a href="#service">–°–µ—Ä–≤–∏—Å</a>
        <a href="#contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
      </div>
    </div>
  </div>
</header>

<div class="main" id="top">
  <div class="container">
    <div class="crumbs">–ì–ª–∞–≤–Ω–∞—è / SHOP</div>

    <div class="pageTitle">
      <div>
        <h1>–ò–Ω—Ç–µ—Ä–Ω–µ—Ç‚Äë–≤–∏—Ç—Ä–∏–Ω–∞ –±–∞—Å—Å–µ–π–Ω–æ–≤ –∏ –¥–æ–º–∞—à–Ω–µ–≥–æ SPA</h1>
        <p class="subtitle">
          –§–æ—Ä–º–∞—Ç –∫–∞–∫ —É –∏–Ω—Ç–µ—Ä–Ω–µ—Ç‚Äë–º–∞–≥–∞–∑–∏–Ω–∞: –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –ø–æ–∏—Å–∫, —Ñ–∏–ª—å—Ç—Ä—ã, –∫–∞—Ä—Ç–æ—á–∫–∏ –∏ ‚Äú–≤ –∫–æ—Ä–∑–∏–Ω—É‚Äù.
          –ù–æ –≥–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å ‚Äî –±—ã—Å—Ç—Ä–æ —Å–æ–±—Ä–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –ø–µ—Ä–µ–π—Ç–∏ –≤ Telegram –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏.
        </p>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <a class="btn btnPrimary" href="#quiz">–ó–∞–∫–∞–∑–∞—Ç—å –ø–æ–¥–±–æ—Ä</a>
        <a class="btn" id="tgTop" href="https://t.me/{TG_USERNAME}">Telegram</a>
      </div>
    </div>

    <div class="grid">
      <!-- Filters -->
      <aside class="panel filters" aria-label="–§–∏–ª—å—Ç—Ä—ã">
        <h3>–§–∏–ª—å—Ç—Ä—ã</h3>

        <div class="fGroup">
          <b>–¢–∏–ø</b>
          <label class="check"><input type="checkbox" class="fType" value="pool" checked> –ë–∞—Å—Å–µ–π–Ω—ã</label>
          <label class="check"><input type="checkbox" class="fType" value="spa" checked> SPA</label>
        </div>

        <div class="fGroup">
          <b>–õ–æ–∫–∞—Ü–∏—è</b>
          <label class="check"><input type="checkbox" class="fLoc" value="indoor" checked> –í–Ω—É—Ç—Ä–∏</label>
          <label class="check"><input type="checkbox" class="fLoc" value="outdoor" checked> –ù–∞ —É–ª–∏—Ü–µ</label>
        </div>

        <div class="fGroup">
          <b>–¶–µ–Ω–∞ (–¥–µ–º–æ)</b>
          <div class="rangeRow">
            <input class="in" id="minPrice" placeholder="–æ—Ç, ‚ÇΩ" inputmode="numeric" />
            <input class="in" id="maxPrice" placeholder="–¥–æ, ‚ÇΩ" inputmode="numeric" />
          </div>
        </div>

        <div class="fGroup">
          <b>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</b>
          <div class="cta">
            <a class="btn btnPrimary" href="#quiz">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å</a>
            <a class="btn" id="tgSide" href="https://t.me/{TG_USERNAME}">–ù–∞–ø–∏—Å–∞—Ç—å –≤ Telegram</a>
          </div>
        </div>

        <div style="font-size:12px;color:var(--muted);line-height:1.45">
          –î–µ–º–æ‚Äë—Ñ–∏–ª—å—Ç—Ä—ã. –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å API/CRM, –∞ ‚Äú–∫–æ—Ä–∑–∏–Ω—É‚Äù –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ ‚Äú–ø–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ‚Äù.
        </div>
      </aside>

      <!-- Catalog -->
      <section class="panel catalog" id="catalog" aria-label="–ö–∞—Ç–∞–ª–æ–≥">
        <div class="toolbar">
          <div class="sort">
            –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:
            <select id="sort">
              <option value="popular">–ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏</option>
              <option value="price_asc">—Ü–µ–Ω–∞ ‚Üë</option>
              <option value="price_desc">—Ü–µ–Ω–∞ ‚Üì</option>
              <option value="discount">–ø–æ —Å–∫–∏–¥–∫–µ</option>
            </select>
          </div>
          <div class="count"><span id="count">0</span> —Ç–æ–≤–∞—Ä–æ–≤</div>
        </div>

        <div class="cards" id="cards"></div>

        <div class="quizShell panel" id="quiz">
          <div class="quizHead">
            <h2>–ó–∞–∫–∞–∑–∞—Ç—å –ø–æ–¥–±–æ—Ä (–∫–≤–∏–∑)</h2>
            <p>–û–¥–∏–Ω –∫–≤–∏–∑ —Å –≤–µ—Ç–≤–ª–µ–Ω–∏–µ–º: ‚Äú–ë–∞—Å—Å–µ–π–Ω‚Äù –∏–ª–∏ ‚ÄúSPA‚Äù. –§–∏–Ω–∞–ª ‚Äî –∫–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ Telegram.</p>
          </div>
          <div class="quizGrid">
            <div class="quizCard">
              <div class="quizTop">
                <div class="progress" aria-label="–ü—Ä–æ–≥—Ä–µ—Å—Å"><div class="bar" id="bar"></div></div>
                <div style="min-width:84px;text-align:right;font-weight:1000" id="stepInfo">0/0</div>
              </div>
              <div id="quizBody"></div>
              <div class="quizNav" id="quizNav">
                <button class="btn" id="backBtn" type="button">–ù–∞–∑–∞–¥</button>
                <button class="btn btnPrimary" id="nextBtn" type="button">–î–∞–ª–µ–µ</button>
              </div>
              <div class="success" id="success">
                <b>–ì–æ—Ç–æ–≤–æ ‚úÖ</b>
                <div style="color:var(--muted);line-height:1.5">
                  –î–∞–ª—å—à–µ —É–¥–æ–±–Ω–µ–µ –≤ Telegram: –æ—Ç–ø—Ä–∞–≤–∏–º –æ—Ä–∏–µ–Ω—Ç–∏—Ä –ø–æ –±—é–¥–∂–µ—Ç—É/—Å—Ä–æ–∫–∞–º –∏ —É—Ç–æ—á–Ω–∏–º –¥–µ—Ç–∞–ª–∏.
                </div>
                <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
                  <a class="btn btnPrimary" id="tgDeep" href="https://t.me/{TG_USERNAME}?start=quiz">–û—Ç–∫—Ä—ã—Ç—å Telegram</a>
                  <a class="btn" href="thanks.html">–°—Ç—Ä–∞–Ω–∏—Ü–∞ ‚Äú–°–ø–∞—Å–∏–±–æ‚Äù</a>
                </div>
              </div>
            </div>

            <aside class="aside">
              <b>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</b>
              <ul class="miniList">
                <li>–í—ã –≤—ã–±–∏—Ä–∞–µ—Ç–µ —Ç–∏–ø: –±–∞—Å—Å–µ–π–Ω –∏–ª–∏ SPA</li>
                <li>–û—Ç–≤–µ—á–∞–µ—Ç–µ –Ω–∞ 6‚Äì9 –≤–æ–ø—Ä–æ—Å–æ–≤</li>
                <li>–ü–æ–ª—É—á–∞–µ—Ç–µ –±—ã—Å—Ç—Ä—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–∞–ª—å–Ω–µ–π—à–∏—Ö —à–∞–≥–æ–≤</li>
                <li>–ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –≤ Telegram –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞</li>
              </ul>
            </aside>
          </div>
        </div>

      </section>
    </div>

    <section class="panel" id="service" style="margin-top:16px;padding:16px">
      <h2 style="margin:0;font-size:20px">–°–µ—Ä–≤–∏—Å –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</h2>
      <p class="subtitle" style="margin-top:8px">
        –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Å–µ–∑–æ–Ω—É, —Ö–∏–º–∏—è –∏ —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–∏, –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è, –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏.
      </p>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
        <a class="btn btnPrimary" href="#quiz">–ó–∞–∫–∞–∑–∞—Ç—å –ø–æ–¥–±–æ—Ä</a>
        <a class="btn" id="tgService" href="https://t.me/{TG_USERNAME}">–ù–∞–ø–∏—Å–∞—Ç—å –≤ Telegram</a>
      </div>
    </section>

    <section class="panel" id="contacts" style="margin-top:16px;padding:16px">
      <h2 style="margin:0;font-size:20px">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h2>
      <div class="hr"></div>
      <div style="display:grid;grid-template-columns: 1fr 1fr;gap:14px" class="foot">
        <div>
          <b>KALIPSO</b>
          <div class="small">–ë–∞—Å—Å–µ–π–Ω—ã –∏ –¥–æ–º–∞—à–Ω–µ–µ SPA</div>
          <div style="margin-top:10px"><b>–¢–µ–ª–µ—Ñ–æ–Ω:</b> <span class="mono">{PHONE}</span></div>
          <div><b>Email:</b> <a href="mailto:{EMAIL}">{EMAIL}</a></div>
          <div><b>–ì–æ—Ä–æ–¥:</b> {CITY}</div>
        </div>
        <div>
          <b>–†–∞–∑–¥–µ–ª—ã</b>
          <div class="small"><a href="#catalog">SHOP</a></div>
          <div class="small"><a href="#quiz">–ó–∞–∫–∞–∑–∞—Ç—å –ø–æ–¥–±–æ—Ä</a></div>
          <div class="small"><a href="#service">–°–µ—Ä–≤–∏—Å</a></div>
        </div>
        <div>
          <b>–ë—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ—Ö–æ–¥</b>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
            <a class="btn btnPrimary btnSm" href="#quiz">–ö–≤–∏–∑</a>
            <a class="btn btnSm" id="tgBottom" href="https://t.me/{TG_USERNAME}">Telegram</a>
          </div>
          <div class="small">¬© 2026 ‚Ä¢ demo prototype</div>
        </div>
      </div>
    </section>

    <footer>
      <div class="container">
        <div class="small">–î–µ–º–æ‚Äë—Å—Ç—Ä–∞–Ω–∏—Ü–∞: —Å—Ç–∏–ª–∏ –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–∏–±–ª–∏–∂–µ–Ω—ã –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç‚Äë–≤–∏—Ç—Ä–∏–Ω–µ. –ú–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ e‚Äëcommerce –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –ª–∏–¥‚Äë–≥–µ–Ω —Å –∫–≤–∏–∑–æ–º.</div>
      </div>
    </footer>

  </div>
</div>

<!-- Cart drawer -->
<div class="overlay" id="overlay">
  <div class="drawer" role="dialog" aria-modal="true" aria-label="–ö–æ—Ä–∑–∏–Ω–∞">
    <div class="drawerHead">
      –ö–æ—Ä–∑–∏–Ω–∞ (–¥–µ–º–æ)
      <button class="closeBtn" id="closeDrawer" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
    </div>
    <div class="drawerBody" id="cartList"></div>
    <div class="drawerFoot">
      <a class="btn btnPrimary" href="#quiz" id="toQuiz">–ó–∞–∫–∞–∑–∞—Ç—å –ø–æ–¥–±–æ—Ä –≤–º–µ—Å—Ç–æ –∫–æ—Ä–∑–∏–Ω—ã</a>
      <a class="btn" id="tgCart" href="https://t.me/{TG_USERNAME}">–ü–µ—Ä–µ–π—Ç–∏ –≤ Telegram</a>
    </div>
  </div>
</div>

<script>
(function(){
  const params = new URLSearchParams(location.search);
  const CITY = params.get('city') || '–ú–æ—Å–∫–≤–∞';
  const PHONE = params.get('phone') || '+7 (999) 000-00-00';
  const EMAIL = params.get('email') || 'sales@example.com';
  const B2B_PHONE = params.get('b2b') || '+7 (495) 000-00-00';
  const TG_USERNAME = params.get('tg') || 'kalipso_demo';

  const repl = (s)=>s
    .replaceAll('{CITY}', CITY)
    .replaceAll('{PHONE}', PHONE)
    .replaceAll('{EMAIL}', EMAIL)
    .replaceAll('{B2B_PHONE}', B2B_PHONE)
    .replaceAll('{TG_USERNAME}', TG_USERNAME);

  document.documentElement.innerHTML = repl(document.documentElement.innerHTML);

  // Mobile nav toggle
  const burger = document.getElementById('burger');
  const mobileNav = document.getElementById('mobileNav');
  burger?.addEventListener('click', ()=>{
    const show = mobileNav.style.display !== 'block';
    mobileNav.style.display = show ? 'block' : 'none';
  });

  // Catalog data (demo)
  const products = [
    {id:'p1', type:'pool', loc:'outdoor', tag:'pool_wood', name:'–ë–∞—Å—Å–µ–π–Ω –ø–æ–¥ –∫–ª—é—á 6√ó3', desc:'–ë–∞–∑–∞: —á–∞—à–∞, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, –ø–æ–¥–æ–≥—Ä–µ–≤, –∑–∞–ø—É—Å–∫.', price:2190000, old:2490000, promo:'–ê–∫—Ü–∏—è'},
    {id:'p2', type:'pool', loc:'indoor', tag:'pool_wood', name:'–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–∞—Å—Å–µ–π–Ω (–ø—Ä–æ–µ–∫—Ç)', desc:'–ü–æ–¥–±–æ—Ä –ø–æ–¥ –ø–æ–º–µ—â–µ–Ω–∏–µ –∏ –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ —É–∑–ª—ã.', price:0, old:0, promo:'–•–∏—Ç'},
    {id:'p3', type:'spa',  loc:'indoor',  tag:'spa_hot', name:'SPA 4 –º–µ—Å—Ç–∞', desc:'–ü–æ–¥–±–æ—Ä –ø–æ –º–µ—Å—Ç—É, –æ–ø—Ü–∏—è–º –∏ —Å—Ü–µ–Ω–∞—Ä–∏—é.', price:690000, old:0, promo:'–ü–æ–ø—É–ª—è—Ä–Ω–æ'},
    {id:'p4', type:'spa',  loc:'outdoor', tag:'spa_hot', name:'SPA –¥–ª—è —É–ª–∏—Ü—ã', desc:'–ü–æ–¥–æ–≥—Ä–µ–≤, –¥–∂–µ—Ç—ã, –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞. –ü–æ–¥–±–æ—Ä –ø–æ–¥ –∫–ª–∏–º–∞—Ç.', price:0, old:0, promo:'–ê–∫—Ü–∏—è'},
    {id:'p5', type:'pool', loc:'outdoor', tag:'pool_robot', name:'–†–æ–±–æ—Ç‚Äë–ø—ã–ª–µ—Å–æ—Å (–ø–æ–¥–±–æ—Ä)', desc:'–ü–æ–¥–±–µ—Ä—ë–º –ø–æ–¥ –æ–±—ä—ë–º –∏ —Ç–∏–ø –±–∞—Å—Å–µ–π–Ω–∞.', price:0, old:0, promo:'–ü–æ–¥–±–æ—Ä'},
    {id:'p6', type:'pool', loc:'outdoor', tag:'pool_chem', name:'–•–∏–º–∏—è –¥–ª—è –±–∞—Å—Å–µ–π–Ω–∞ (–Ω–∞–±–æ—Ä)', desc:'–ö–æ–º–ø–ª–µ–∫—Ç –Ω–∞ —Å–µ–∑–æ–Ω ‚Äî –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –≤–æ–¥—ã.', price:17900, old:23900, promo:'–í—ã–≥–æ–¥–Ω–æ'},
    {id:'p7', type:'spa',  loc:'indoor',  tag:'spa_ir', name:'–ò–Ω—Ñ—Ä–∞–∫—Ä–∞—Å–Ω–∞—è –∫–∞–±–∏–Ω–∞', desc:'–ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –¥–æ–º–∞, –ø–æ–¥–±–æ—Ä –ø–æ –º–µ—Å—Ç—É.', price:159000, old:0, promo:'–ù–æ–≤–∏–Ω–∫–∞'},
    {id:'p8', type:'pool', loc:'outdoor', tag:'pool_wood', name:'–ë–∞—Å—Å–µ–π–Ω 8√ó4 (—Å–µ–º–µ–π–Ω—ã–π)', desc:'–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ –ø–æ–¥ –±—é–¥–∂–µ—Ç –∏ —Å—Ä–æ–∫.', price:3190000, old:0, promo:'–ü—Ä–æ–µ–∫—Ç'},
    {id:'p9', type:'spa',  loc:'indoor',  tag:'spa_hot', name:'SPA 2 –º–µ—Å—Ç–∞ (–∫–æ–º–ø–∞–∫—Ç)', desc:'–ë—ã—Å—Ç—Ä—ã–π –º–æ–Ω—Ç–∞–∂, –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å.', price:490000, old:0, promo:'–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç'},
  ];

  const fmtRub = (n)=> n.toLocaleString('ru-RU') + ' ‚ÇΩ';

  // State
  let cart = [];
  let fav = new Set();

  // Elements
  const cardsEl = document.getElementById('cards');
  const countEl = document.getElementById('count');
  const sortEl = document.getElementById('sort');
  const searchInput = document.getElementById('searchInput');

  const cartCount = document.getElementById('cartCount');
  const favCount = document.getElementById('favCount');
  const cartBtn = document.getElementById('cartBtn');
  const favBtn = document.getElementById('favBtn');
  const overlay = document.getElementById('overlay');
  const closeDrawer = document.getElementById('closeDrawer');
  const cartList = document.getElementById('cartList');
  const toQuiz = document.getElementById('toQuiz');

  // Filters
  const typeChecks = Array.from(document.querySelectorAll('.fType'));
  const locChecks  = Array.from(document.querySelectorAll('.fLoc'));
  const minPriceEl = document.getElementById('minPrice');
  const maxPriceEl = document.getElementById('maxPrice');

  // Tag quick links in dropdown
  document.querySelectorAll('[data-tag]').forEach(a=>{
    a.addEventListener('click', (e)=>{
      const tag = a.getAttribute('data-tag');
      if(tag){
        e.preventDefault();
        location.hash = '#catalog';
        activeTag = tag;
        render();
      }
    });
  });

  let activeTag = null;

  function openDrawer(){
    overlay.style.display = 'block';
    document.body.style.overflow = 'hidden';
    renderDrawer();
  }
  function closeAll(){
    overlay.style.display = 'none';
    document.body.style.overflow = '';
  }
  cartBtn?.addEventListener('click', openDrawer);
  closeDrawer?.addEventListener('click', closeAll);
  overlay?.addEventListener('click', (e)=>{ if(e.target === overlay) closeAll(); });
  toQuiz?.addEventListener('click', ()=>closeAll());

  favBtn?.addEventListener('click', ()=>{
    alert('–ò–∑–±—Ä–∞–Ω–Ω–æ–µ (–¥–µ–º–æ): ' + (fav.size ? Array.from(fav).join(', ') : '–ø—É—Å—Ç–æ'));
  });

  function parseNum(s){
    if(!s) return null;
    const x = String(s).replace(/[^\d]/g,'');
    return x ? Number(x) : null;
  }

  function currentFilters(){
    const types = new Set(typeChecks.filter(c=>c.checked).map(c=>c.value));
    const locs = new Set(locChecks.filter(c=>c.checked).map(c=>c.value));
    const q = (searchInput?.value || '').trim().toLowerCase();
    const minP = parseNum(minPriceEl?.value);
    const maxP = parseNum(maxPriceEl?.value);
    return {types, locs, q, minP, maxP};
  }

  function sortItems(items){
    const mode = sortEl?.value || 'popular';
    const withPrice = (p)=> (p.price && p.price>0) ? p.price : Infinity;
    const discount = (p)=> (p.old && p.price && p.old>p.price) ? (p.old - p.price) : 0;

    if(mode === 'price_asc') return items.slice().sort((a,b)=>withPrice(a)-withPrice(b));
    if(mode === 'price_desc') return items.slice().sort((a,b)=>withPrice(b)-withPrice(a));
    if(mode === 'discount') return items.slice().sort((a,b)=>discount(b)-discount(a));
    return items; // popular: as-is
  }

  function visibleProducts(){
    const {types, locs, q, minP, maxP} = currentFilters();
    return sortItems(products.filter(p=>{
      if(activeTag && p.tag !== activeTag) return false;
      if(!types.has(p.type)) return false;
      if(!locs.has(p.loc)) return false;
      if(q){
        const hay = (p.name+' '+p.desc).toLowerCase();
        if(!hay.includes(q)) return false;
      }
      if(minP !== null && p.price && p.price>0 && p.price < minP) return false;
      if(maxP !== null && p.price && p.price>0 && p.price > maxP) return false;
      return true;
    }));
  }

  function renderDrawer(){
    cartList.innerHTML = '';
    if(cart.length === 0){
      cartList.innerHTML = '<div style="color:var(--muted);padding:6px 2px">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è. –≠—Ç–æ –¥–µ–º–æ ‚Äî –ª—É—á—à–µ ‚Äú–∑–∞–∫–∞–∑–∞—Ç—å –ø–æ–¥–±–æ—Ä‚Äù —á–µ—Ä–µ–∑ –∫–≤–∏–∑.</div>';
      return;
    }
    cart.forEach(id=>{
      const p = products.find(x=>x.id===id);
      if(!p) return;
      const div = document.createElement('div');
      div.className = 'cartItem';
      div.innerHTML = `
        <div class="thumb"></div>
        <div style="min-width:0">
          <b>${p.name}</b>
          <span>${p.price && p.price>0 ? fmtRub(p.price) : '–¶–µ–Ω–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É'}</span>
        </div>
      `;
      cartList.appendChild(div);
    });
  }

  function render(){
    const items = visibleProducts();
    countEl.textContent = items.length;

    cardsEl.innerHTML = '';
    items.forEach(p=>{
      const el = document.createElement('div');
      el.className = 'card';
      const hasDisc = p.old && p.price && p.old > p.price;
      const disc = hasDisc ? (p.old - p.price) : 0;

      el.innerHTML = `
        <div class="img">
          <div class="labels">
            <span class="lab ${p.promo==='–ê–∫—Ü–∏—è'?'gold':''}">${p.promo}</span>
            ${hasDisc ? `<span class="lab gold">–í—ã–≥–æ–¥–∞ ${fmtRub(disc)}</span>` : ``}
          </div>
        </div>
        <div class="body">
          <div class="name">${p.name}</div>
          <div class="desc">${p.desc}</div>

          <div class="priceRow">
            <div>
              ${hasDisc ? `<div class="old">${fmtRub(p.old)}</div>` : ``}
              <div class="price">${p.price && p.price>0 ? fmtRub(p.price) : '–¶–µ–Ω–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É'}</div>
            </div>
            <div class="benefit">${hasDisc ? '–°–∫–∏–¥–∫–∞' : '–ü–æ–¥–±–æ—Ä'}</div>
          </div>

          <div class="cardBtns">
            <button class="btn btnPrimary btnSm" data-add="${p.id}" type="button">–í –∫–æ—Ä–∑–∏–Ω—É</button>
            <button class="btn btnSm" data-fav="${p.id}" type="button">‚ô•</button>
          </div>

          <div class="cardBtns">
            <button class="btn btnSm" data-prefill="${p.type}" type="button">–ó–∞–∫–∞–∑–∞—Ç—å –ø–æ–¥–±–æ—Ä</button>
            <a class="btn btnSm" href="#quiz">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
          </div>
        </div>
      `;
      cardsEl.appendChild(el);
    });

    // Bind buttons
    document.querySelectorAll('[data-add]').forEach(b=>{
      b.addEventListener('click', ()=>{
        const id = b.getAttribute('data-add');
        if(!id) return;
        cart.push(id);
        cartCount.textContent = cart.length;
        openDrawer();
      });
    });
    document.querySelectorAll('[data-fav]').forEach(b=>{
      b.addEventListener('click', ()=>{
        const id = b.getAttribute('data-fav');
        if(!id) return;
        if(fav.has(id)) fav.delete(id); else fav.add(id);
        favCount.textContent = String(fav.size);
      });
    });
    document.querySelectorAll('[data-prefill]').forEach(b=>{
      b.addEventListener('click', ()=>{
        const t = b.getAttribute('data-prefill');
        startQuizWithProduct(t === 'spa' ? 'spa' : 'pool');
        location.hash = '#quiz';
      });
    });
  }

  [sortEl, searchInput, minPriceEl, maxPriceEl].forEach(el=>{
    el?.addEventListener('input', ()=>{ activeTag = null; render(); });
    el?.addEventListener('change', ()=>{ activeTag = null; render(); });
  });
  typeChecks.forEach(c=>c.addEventListener('change', ()=>{ activeTag=null; render(); }));
  locChecks.forEach(c=>c.addEventListener('change', ()=>{ activeTag=null; render(); }));

  // ---- Quiz (lead funnel) ----
  const qCommonFinal = [
    { key:'name', type:'text', label:'–í–∞—à–µ –∏–º—è', placeholder:'–ù–∞–ø—Ä–∏–º–µ—Ä, –¢–∏–º—É—Ä' },
    { key:'phone', type:'tel', label:'–¢–µ–ª–µ—Ñ–æ–Ω', placeholder:'+7 ‚Ä¶' },
    { key:'contact', type:'choice', label:'–ö–∞–∫ —Å–≤—è–∑–∞—Ç—å—Å—è?', options:['Telegram','WhatsApp','–ó–≤–æ–Ω–æ–∫'] }
  ];

  const qPool = [
    { key:'product_type', type:'choice', label:'–ß—Ç–æ –Ω—É–∂–Ω–æ?', options:['–ë–∞—Å—Å–µ–π–Ω','SPA'] },
    { key:'pool_where', type:'choice', label:'–ì–¥–µ –±—É–¥–µ—Ç –±–∞—Å—Å–µ–π–Ω?', options:['–í–Ω—É—Ç—Ä–∏','–ù–∞ —É–ª–∏—Ü–µ','–ù–µ –∑–Ω–∞—é'] },
    { key:'pool_size', type:'choice', label:'–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä?', options:['–¥–æ 15 –º¬≤','15‚Äì30 –º¬≤','30+ –º¬≤','–ù–µ –∑–Ω–∞—é'] },
    { key:'pool_kind', type:'choice', label:'–§–æ—Ä–º–∞—Ç?', options:['–°–µ–º–µ–π–Ω—ã–π','–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–π','–ú–∏–Ω–∏/Plunge','–ù–µ –∑–Ω–∞—é'] },
    { key:'timeline', type:'choice', label:'–°—Ä–æ–∫–∏?', options:['–í —ç—Ç–æ–º —Å–µ–∑–æ–Ω–µ','1‚Äì3 –º–µ—Å—è—Ü–∞','3‚Äì6 –º–µ—Å—è—Ü–µ–≤','–ü–ª–∞–Ω–∏—Ä—É—é'] },
    { key:'budget', type:'choice', label:'–ë—é–¥–∂–µ—Ç?', options:['–î–æ X','X‚ÄìY','Y+','–ù—É–∂–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è'] },
    { key:'pool_opts', type:'multi', label:'–û–ø—Ü–∏–∏ (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)', options:['–ü–æ–¥–æ–≥—Ä–µ–≤','–ü–æ–¥—Å–≤–µ—Ç–∫–∞','–ê–≤—Ç–æ–º–∞—Ç–∏–∫–∞','–ü—Ä–æ—Ç–∏–≤–æ—Ç–æ–∫'] },
    ...qCommonFinal
  ];

  const qSpa = [
    { key:'product_type', type:'choice', label:'–ß—Ç–æ –Ω—É–∂–Ω–æ?', options:['–ë–∞—Å—Å–µ–π–Ω','SPA'] },
    { key:'spa_capacity', type:'choice', label:'–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å?', options:['2 —á–µ–ª–æ–≤–µ–∫–∞','4 —á–µ–ª–æ–≤–µ–∫–∞','6+','–ù–µ –∑–Ω–∞—é'] },
    { key:'spa_where', type:'choice', label:'–ì–¥–µ –±—É–¥–µ—Ç SPA?', options:['–í–Ω—É—Ç—Ä–∏','–ù–∞ —É–ª–∏—Ü–µ','–ù–µ –∑–Ω–∞—é'] },
    { key:'spa_install', type:'choice', label:'–¢–∏–ø —É—Å—Ç–∞–Ω–æ–≤–∫–∏?', options:['–ü–µ—Ä–µ–Ω–æ—Å–Ω–æ–π','–í—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π','–ù–µ –∑–Ω–∞—é'] },
    { key:'spa_goal', type:'choice', label:'–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å?', options:['–†–µ–ª–∞–∫—Å','–¢–µ—Ä–∞–ø–∏—è','–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ','–ù–µ –∑–Ω–∞—é'] },
    { key:'spa_opts', type:'multi', label:'–û–ø—Ü–∏–∏ (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)', options:['–î–∂–µ—Ç—ã/–≥–∏–¥—Ä–æ–º–∞—Å—Å–∞–∂','–ü–æ–¥–æ–≥—Ä–µ–≤','–ü–æ–¥—Å–≤–µ—Ç–∫–∞','–ê–≤—Ç–æ–º–∞—Ç–∏–∫–∞'] },
    { key:'timeline', type:'choice', label:'–°—Ä–æ–∫–∏?', options:['–í —ç—Ç–æ–º —Å–µ–∑–æ–Ω–µ','1‚Äì3 –º–µ—Å—è—Ü–∞','3‚Äì6 –º–µ—Å—è—Ü–µ–≤','–ü–ª–∞–Ω–∏—Ä—É—é'] },
    { key:'budget', type:'choice', label:'–ë—é–¥–∂–µ—Ç?', options:['–î–æ X','X‚ÄìY','Y+','–ù—É–∂–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è'] },
    ...qCommonFinal
  ];

  let flow = [];
  let step = 0;
  let answers = {};
  let productLocked = null;

  const quizBody = document.getElementById('quizBody');
  const bar = document.getElementById('bar');
  const stepInfo = document.getElementById('stepInfo');
  const backBtn = document.getElementById('backBtn');
  const nextBtn = document.getElementById('nextBtn');
  const nav = document.getElementById('quizNav');
  const success = document.getElementById('success');

  function progress(){
    const total = flow.length;
    const current = Math.min(step+1, total);
    stepInfo.textContent = current + '/' + total;
    bar.style.width = (Math.max(0, Math.min(1, current/total))*100).toFixed(0)+'%';
  }

  function renderQuiz(){
    success.style.display = 'none';
    nav.style.display = 'flex';
    progress();

    const q = flow[step];
    if(!q){
      nav.style.display = 'none';
      success.style.display = 'block';
      const tgDeep = document.getElementById('tgDeep');
      const tg = 'https://t.me/'+TG_USERNAME+'?start=quiz_'+encodeURIComponent((answers.product_type||'').toLowerCase());
      if(tgDeep) tgDeep.href = tg;
      return;
    }

    quizBody.innerHTML = '';
    const title = document.createElement('div');
    title.className = 'qTitle';
    title.textContent = q.label;
    quizBody.appendChild(title);

    if(q.type === 'choice'){
      const wrap = document.createElement('div');
      wrap.className = 'opts';
      q.options.forEach(opt=>{
        const b = document.createElement('button');
        b.type = 'button';
        b.className = 'opt';
        b.textContent = opt;
        if(answers[q.key] === opt) b.style.borderColor = 'rgba(14,77,178,.55)';
        b.addEventListener('click', ()=>{
          answers[q.key] = opt;
          if(q.key === 'product_type' && !productLocked){
            if(opt === 'SPA'){ flow = qSpa; }
            else { flow = qPool; }
            answers = { product_type: opt };
            step = 1;
          } else {
            step = Math.min(step+1, flow.length);
          }
          renderQuiz();
        });
        wrap.appendChild(b);
      });
      quizBody.appendChild(wrap);
      backBtn.disabled = (step === 0 || (productLocked && step === 1));
    }

    if(q.type === 'multi'){
      const wrap = document.createElement('div');
      wrap.className = 'opts';
      const cur = new Set((answers[q.key] || []));
      q.options.forEach(opt=>{
        const b = document.createElement('button');
        b.type = 'button';
        b.className = 'opt';
        b.textContent = cur.has(opt) ? ('‚úì ' + opt) : opt;
        if(cur.has(opt)){
          b.style.borderColor = 'rgba(14,77,178,.55)';
          b.style.boxShadow = '0 0 0 4px var(--ring)';
        }
        b.addEventListener('click', ()=>{
          if(cur.has(opt)) cur.delete(opt); else cur.add(opt);
          answers[q.key] = Array.from(cur);
          renderQuiz();
        });
        wrap.appendChild(b);
      });
      quizBody.appendChild(wrap);

      const hint = document.createElement('div');
      hint.style.marginTop = '10px';
      hint.style.color = 'var(--muted)';
      hint.style.fontSize = '13px';
      hint.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏–∏ –∏ –Ω–∞–∂–º–∏—Ç–µ ‚Äú–î–∞–ª–µ–µ‚Äù.';
      quizBody.appendChild(hint);
      backBtn.disabled = (step === 0 || (productLocked && step === 1));
    }

    if(q.type === 'text' || q.type === 'tel'){
      const fields = document.createElement('div');
      fields.className = 'fields';

      const input = document.createElement('input');
      input.className = 'in';
      input.type = q.type === 'tel' ? 'tel' : 'text';
      input.placeholder = q.placeholder || '';
      input.value = answers[q.key] || '';
      input.addEventListener('input', ()=>{ answers[q.key] = input.value; });
      fields.appendChild(input);

      quizBody.appendChild(fields);
      backBtn.disabled = (step === 0 || (productLocked && step === 1));
    }

    backBtn.onclick = ()=>{
      if(step > 0){
        step -= 1;
        renderQuiz();
      }
    };

    nextBtn.onclick = ()=>{
      if(q.type === 'text' || q.type === 'tel'){
        const v = (answers[q.key] || '').trim();
        if(!v){ alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–µ: ' + q.label); return; }
      }
      if(q.type === 'choice' && !answers[q.key]){
        alert('–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç.'); return;
      }
      step = Math.min(step+1, flow.length);
      renderQuiz();
    };
  }

  function startQuizWithProduct(pref){
    productLocked = pref;
    if(pref === 'pool'){
      flow = qPool; answers = { product_type: '–ë–∞—Å—Å–µ–π–Ω' }; step = 1;
    } else if(pref === 'spa'){
      flow = qSpa; answers = { product_type: 'SPA' }; step = 1;
    } else {
      productLocked = null; flow = qPool; answers = {}; step = 0;
    }
    renderQuiz();
  }

  // init
  const prefill = params.get('prefill');
  if(prefill === 'pool' || prefill === 'spa') startQuizWithProduct(prefill);
  else startQuizWithProduct(null);

  // first render catalog
  render();

  // City dialog (simple)
  document.getElementById('cityBtn')?.addEventListener('click', ()=>{
    const v = prompt('–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥', CITY);
    if(v){
      const url = new URL(location.href);
      url.searchParams.set('city', v);
      location.href = url.toString();
    }
  });
})();
</script>

</body>
</html>
